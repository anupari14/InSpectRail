{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block extra_css %}
<style>
  /* —— HERO —— */
  .hero-section {
    position: relative;
    width:100%; height:60vh; min-height:300px;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .hero-bg {
    position:absolute; inset:0;
    background: url("{% image page.banner_image original as bg %}{{ bg.url }}") center/cover;
    filter: blur(6px) brightness(0.5);
    transform: scale(1.05); z-index:1;
  }
  .hero-overlay {
    position:absolute; inset:0;
    background: rgba(0,0,0,0.3); z-index:2;
  }
  .hero-content {
    position:relative; z-index:3;
    text-align:center; color:#fff; padding:0 1rem;
  }
  .hero-content h1 {
    font-size:2.5rem; font-weight:700;
    text-shadow:0 2px 6px rgba(0,0,0,0.7);
  }

  /* —— BUTTONS —— */
  .btn-video {
    font-weight:600; border-radius:6px;
    padding:.75rem 1.5rem; transition:all .3s;
  }
  .btn-video.primary {
    background:transparent; color:#ff004f;
    border:2px solid #ff004f;
  }
  .btn-video.primary:hover,
  .btn-video.primary.active {
    background:#ff004f; color:#fff;
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(255,0,79,0.5);
  }

  /* —— SECTIONS —— */
  .section {
    padding:3rem 1rem;
    background: rgba(255,255,255,0.9);
    margin-bottom:2rem;
    border-radius:8px;
  }

  /* —— CAROUSELS —— */
  .carousel-image {
    max-height:500px;
    object-fit:contain;
    width:100%;
    border-radius:8px;
  }
</style>
{% endblock %}

{% block hero %}
<section class="hero-section">
  <div class="hero-bg"></div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1>{{ page.name_title }}</h1>
    <p class="lead">{{ page.name_subtitle|richtext }}</p>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="container">

  <!-- Upload / Start Section -->
  <section class="section text-center">
    <form method="POST" enctype="multipart/form-data" class="d-inline-block">
      {% csrf_token %}
      <input type="file" name="file_data" accept="image/*" multiple class="mb-2">
      <button type="submit" class="btn-video primary">Upload</button>
    </form>
    <form method="POST" class="d-inline-block">
      {% csrf_token %}
      <button type="submit" name="start" class="btn-video primary">Start Detection</button>
    </form>
  </section>

  <!-- List of Uploaded Files -->
  <section class="section">
    <h5>Uploaded Files</h5>
    <ul>
      {% for f in my_uploaded_file_names %}
        <li><a href="{{ f }}" target="_blank">{{ f|slice:"-30:" }}</a></li>
      {% empty %}
        <li>No files uploaded yet.</li>
      {% endfor %}
    </ul>
  </section>

  <!-- Tabs & Carousels -->
  <section class="section">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active"
           id="raw-tab"
           data-toggle="tab"
           href="#raw"
           role="tab"
           aria-controls="raw"
           aria-selected="true">
          Raw Images
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link"
           id="result-tab"
           data-toggle="tab"
           href="#result"
           role="tab"
           aria-controls="result"
           aria-selected="false">
          Result Images
        </a>
      </li>
    </ul>
    <div class="tab-content mt-3">
      <!-- Raw -->
      <div class="tab-pane fade show active" id="raw" role="tabpanel" aria-labelledby="raw-tab">
        <div id="carouselRaw" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            {% for file in my_uploaded_file_names %}
              <li data-target="#carouselRaw"
                  data-slide-to="{{ forloop.counter0 }}"
                  class="{% if forloop.first %}active{% endif %}">
              </li>
            {% endfor %}
          </ol>
          <div class="carousel-inner">
            {% for file in my_uploaded_file_names %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <a href="{{ file }}" target="_blank">
                  <img src="{{ file }}" class="d-block carousel-image">
                </a>
              </div>
            {% endfor %}
          </div>
          <a class="carousel-control-prev" href="#carouselRaw" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </a>
          <a class="carousel-control-next" href="#carouselRaw" role="button" data-slide="next">
            <span class="carousel-control-next-icon"></span>
          </a>
        </div>
      </div>

      <!-- Result -->
      <div class="tab-pane fade" id="result" role="tabpanel" aria-labelledby="result-tab">
        <div id="carouselResult" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            {% for file in my_result_file_names %}
              <li data-target="#carouselResult"
                  data-slide-to="{{ forloop.counter0 }}"
                  class="{% if forloop.first %}active{% endif %}">
              </li>
            {% endfor %}
          </ol>
          <div class="carousel-inner">
            {% for file in my_result_file_names %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <a href="{{ file }}" target="_blank">
                  <img src="{{ file }}" class="d-block carousel-image">
                </a>
              </div>
            {% endfor %}
          </div>
          <a class="carousel-control-prev" href="#carouselResult" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </a>
          <a class="carousel-control-next" href="#carouselResult" role="button" data-slide="next">
            <span class="carousel-control-next-icon"></span>
          </a>
        </div>
      </div>
    </div>
  </section>

</div>
{% endblock %}
